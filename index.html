<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>HTML Diff & Patch Werkzeug (Optimiert)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <meta name="theme-color" content="#1e40af">

  <script>
    const basePath = window.location.pathname.split('/').filter(Boolean)[0]
                     ? '/' + window.location.pathname.split('/')[0] + '/'
                     : '/';
    const manifestLink = document.createElement('link');
    manifestLink.rel = 'manifest';
    manifestLink.href = basePath + 'manifest.json';
    document.head.appendChild(manifestLink);
  </script>
</head>
<body class="bg-gray-900 text-white p-4">
  <h1 class="text-3xl font-bold mb-4">HTML Diff & Patch Werkzeug ðŸš€</h1>
  <p class="text-gray-400 mb-6">Diese App kann jetzt als PWA installiert werden und funktioniert auch offline.</p>

  <div id="updateSnackbar"
       class="hidden fixed bottom-4 left-1/2 -translate-x-1/2 bg-indigo-600 text-white px-4 py-3 rounded-xl shadow-lg flex items-center space-x-3 z-50">
    <span>ðŸ”„ Neue Version verfÃ¼gbar</span>
    <button id="reloadButton" class="bg-white text-indigo-700 font-semibold px-3 py-1 rounded-lg hover:bg-gray-200 transition">
      Aktualisieren
    </button>
  </div>

  <script>
  if ('serviceWorker' in navigator) {
    navigator.serviceWorker.register('./sw.js').then(registration => {
      registration.addEventListener('updatefound', () => {
        const newWorker = registration.installing;
        newWorker.addEventListener('statechange', () => {
          if (newWorker.state === 'installed' && navigator.serviceWorker.controller) {
            const bar = document.getElementById('updateSnackbar');
            bar.classList.remove('hidden');
            document.getElementById('reloadButton').addEventListener('click', () => {
              newWorker.postMessage({ type: 'SKIP_WAITING' });
            });
          }
        });
      });
    });
    let refreshing;
    navigator.serviceWorker.addEventListener('controllerchange', () => {
      if (refreshing) return;
      refreshing = true;
      window.location.reload();
    });
  }
  </script>
</body>
</html>
